# 食べ物クイズレビューアプリケーション

## プロジェクト概要
4選択肢形式の食べ物クイズに解答できるWebアプリケーション。ローカルまたはGitHub Pagesに保存された問題データ(JSON)を読み込み、レビューアが1人ずつレビューを行い、結果をローカルストレージに保存する。

**現在の実装状況**:
- ✅ 実装済み: 1人ずつのレビュー形式
- ✅ 実装済み: 食べ物カテゴリに特化した問題セット

## 目的
- 食べ物に関する4選択肢のクイズに回答
- 正解/不正解の即座なフィードバック
- レビュー結果の記録と分析

## システム構成

### データソース
- **GitHub リポジトリ** または **ローカルフォルダ**: 食べ物クイズデータ
  - フォルダ構成:
    - `food_quiz/` (問題セット)
      - `questions.json`: 食べ物クイズ問題データ

### アーキテクチャ
1. **フロントエンド**: HTML/CSS/JavaScript (静的サイト)
2. **データ取得**: GitHub API または ローカルファイル経由
3. **結果保存**: ローカルストレージ + エクスポート機能

## 主要機能

### 1. ホーム画面（index.html）
- **レビューア名入力欄** (1つのみ)
  - 必須入力。入力されるまで開始できない
- **問題セット選択**
  - プリセット: food_quiz（カード形式で表示）
  - カスタムURL: GitHubリポジトリURLを直接入力可能
- **入力検証とエラー表示**
  - 未入力の場合はエラーメッセージ表示
- レビューア名と問題セットをlocalStorageに保存してreview.htmlに遷移

### 2. レビュー画面（review.html）
- **ヘッダー**
  - 進捗表示（現在の問題番号/全問題数）
  - 問題セット名
  - レビューア名表示
- **問題表示エリア**
  - 問題ID（badge形式）
  - キーワード（badge形式）
  - カテゴリ（badge形式）
  - 問題文
  - 年代情報（あれば表示）
  - 参考URL（あれば表示）
- **回答エリア（1人分）**
  - 4つの選択肢ボタン（questions.jsonの"choice"配列から）
  - 1つだけ選択可能
  - コメント入力欄（オプション）
- **結果表示エリア**
  - 選択した選択肢、正誤判定、コメントを表示
  - 正解の選択肢を表示
  - 選択肢ボタンに色分け（正解: 緑、不正解: 赤）
- **アクションボタン**
  - 「回答を提出」: 回答選択後に有効化
  - 「次の問題へ」: 提出後に表示
  - 「レビュー完了」: 最後の問題で提出後に表示
  - 「ホームに戻る」: 確認ダイアログ付き

### 3. データ保存（storage.js）
- **レビュー結果の記録** (各問題提出時に自動保存)
  - レビューID（一意）
  - 問題ID、問題セット名、問題インデックス
  - キーワード、カテゴリ、問題文
  - レビューア名（1人）
  - 選択した選択肢インデックス
  - 正誤判定（true/false）
  - 正解インデックス
  - タイムスタンプ（ISO 8601形式）
  - コメント（任意）
- **保存先**: ブラウザのlocalStorage
  - キー: `food_review_results`
  - 形式: JSON配列（追加形式）
- **エクスポート機能**
  - JSON形式でダウンロード
  - CSV形式でダウンロード（Excel対応、BOM付きUTF-8）
  - ファイル名: `food_review_results_YYYYMMDD_HHMMSS.json/csv`
- **統計機能**
  - 全体の統計情報取得
  - カテゴリごとの統計
  - レビューアごとの正解率計算
- **データ管理**
  - すべてのデータ削除（確認ダイアログ付き）
  - カテゴリ別/レビューア別のフィルタリング

## データフォーマット

### questions.json (問題データ)
```json
{
  "questionID": "Q001",
  "keyword": "キーワード",
  "category": "カテゴリ",
  "question": "質問文",
  "choice": [
    "選択肢1(正解)",
    "選択肢2",
    "選択肢3",
    "選択肢4"
  ],
  "year": "2024",
  "reference_url": "https://example.com/reference",
  "authored_by": "claude"
}
```

**フィールド説明:**
- `questionID`: 問題の一意な識別子（必須）
- `keyword`: 問題のキーワード（任意、空文字列可）
- `category`: 問題のカテゴリ（必須）
- `question`: 質問文（必須）
- `choice`: 選択肢の配列（必須、最初が正解）
- `year`: 年代情報（任意、空文字列可）
- `reference_url`: 参考URL（任意、空文字列可）
- `authored_by`: 作成者（必須）

**注**: 正解は常に`choice`配列の最初の要素（インデックス0）です。

### 結果保存形式 (localStorage)
```json
{
  "review_id": "review_1729651234567_abc123xyz",
  "question_id": "Q001",
  "question_set": "food_quiz",
  "question_index": 0,
  "keyword": "バスクチーズケーキ",
  "category": "スイーツ",
  "question_text": "バスクチーズケーキの名前にもなっているバスク地方がある国はどこ？",
  "reviewer_name": "山田太郎",
  "answer": 0,
  "correct_answer": 0,
  "is_correct": true,
  "timestamp": "2025-10-31T10:30:45.123Z",
  "comment": "スペインの有名な地域"
}
```

## 技術仕様

### フロントエンド
- **HTML5**: セマンティックなマークアップ
  - index.html: ホーム画面
  - review.html: レビュー画面
- **CSS3**: レスポンシブデザイン、モダンなUI
  - css/style.css: 統合スタイルシート
  - カラースキーム: 食べ物テーマに合わせた暖色系配色
  - ボタンの状態管理: selected, correct, incorrect
- **JavaScript (Vanilla ES6+)**:
  - js/app.js: メインロジック（問題表示、回答管理、ナビゲーション）
  - js/github.js: GitHub/ローカルファイル連携
  - js/storage.js: データ保存・エクスポート・統計
  - 非同期処理: async/await使用
  - モジュールパターン: 各JSファイルはグローバル名前空間を汚染しない

### データ取得（github.js）

1. **ローカルファイル取得** (デフォルト)
   - 相対パスで直接アクセス
   - `food_quiz/questions.json`
   - GitHub Pagesまたはローカルサーバーで動作
   - 認証不要、最もシンプル

2. **GitHub API経由取得** (カスタムURL機能)
   - REST API v3使用
   - `GET /repos/{owner}/{repo}/contents/{path}`
   - URLをAPI URLに自動変換
   - パブリックリポジトリなら認証不要
   - 動的なリポジトリ参照が可能

### データ保存（storage.js）

- **localStorage API**
  - ブラウザ内で完結、追加設定不要
  - `food_review_results`キーに全データ保存
  - JSON配列形式で追加保存

- **エクスポート機能**
  - JSON形式ダウンロード
  - CSV形式ダウンロード（Excel対応）
  - タイムスタンプ付きファイル名

- **統計機能**
  - レビューアごとの正解率
  - カテゴリごとの統計
  - 全体サマリー

## ディレクトリ構成

```
food_quiz_app/
├── index.html              # ホーム画面
├── review.html             # レビュー画面
├── css/
│   └── style.css          # スタイルシート
├── js/
│   ├── app.js             # メインロジック
│   ├── github.js          # データ取得
│   └── storage.js         # データ保存・統計
├── food_quiz/             # 問題セット
│   └── questions.json     # 食べ物クイズデータ
├── Claude.md              # プロジェクト仕様書（このファイル）
├── README.md              # 使用方法説明
└── SETUP.md               # セットアップガイド
```

## 開発ステップ

### Phase 1: 基本機能
1. ✅ ホーム画面の作成（レビューア名入力、問題セット選択）
2. ✅ ローカル/GitHubからデータ取得
3. ✅ 選択肢の表示
4. ✅ 1人のレビューアの回答選択と正誤判定
5. ✅ 進捗表示とナビゲーション

### Phase 2: データ保存
1. ✅ レビュー結果の構造化
2. ✅ ローカルストレージへの保存
3. ✅ エクスポート機能（JSON/CSV）
4. ✅ 統計機能

### Phase 3: UI改善
1. ✅ レスポンシブデザイン
2. ✅ 視覚的フィードバック（色分け、ボタン状態）
3. ✅ エラーハンドリング
4. ✅ ローディング表示
5. ✅ スムーズスクロール

### Phase 4: 追加機能
1. ⏳ 履歴表示画面
2. ✅ 統計情報（StorageManager.getStatistics()）
3. ✅ エクスポート機能（JSON/CSV）
4. ⏳ 結果の可視化（グラフ表示など）

## 重要な実装詳細

### データの扱い
- **正解の位置**: 正解は常に`choice`配列の**最初の要素（インデックス0）**
- **回答インデックス**: 選択肢は0-3のインデックスで管理
- **レビューア**: 1人ずつレビュー
- **問題ID形式**: JSONファイルの`questionID`をそのまま使用 (例: `Q001`)
- **レビューID形式**: `review_{タイムスタンプ}_{ランダム文字列}`

### ワークフロー
1. ユーザーがホーム画面でレビューア名を入力（1人）
2. 問題セットを選択
3. レビュー画面で回答を選択
4. 回答選択後に提出ボタンが有効化
5. 提出すると正誤判定と結果表示
6. 自動的にlocalStorageに保存
7. 次の問題へ、または完了

### ブラウザ要件
- モダンブラウザ（ES6+対応）
- localStorage有効
- JavaScript有効
- Fetch API対応

### ローカル開発
- HTTPサーバーが必要（file://プロトコルではFetch APIが動作しない）
- 推奨: `python -m http.server 8000` または Live Server拡張機能
- CORS制約なし（同一オリジン）

## 今後の拡張案

### 優先度: 高
1. **履歴表示画面**
   - 過去のレビュー結果を一覧表示
   - フィルタリング機能（カテゴリ別、レビューア別、日付範囲）
   - StorageManager APIは実装済み、UIの実装が必要

2. **統計ダッシュボード**
   - レビューアごとの正解率グラフ
   - カテゴリごとの難易度分析
   - 時系列での成績推移

3. **データのインポート機能**
   - 以前エクスポートしたJSONファイルを読み込み
   - 複数デバイス間でのデータ同期

### 優先度: 中
4. **問題セット管理画面**
   - 利用可能な問題セットの一覧表示
   - 問題セットのプレビュー機能

5. **レビューモードの拡張**
   - タイマー機能（制限時間設定）
   - 複数問題の一括レビュー
   - ランダム出題順序

6. **UI/UX改善**
   - ダークモード対応
   - キーボードショートカット
   - 進捗の永続化（中断・再開機能）

### 優先度: 低
7. **クラウド連携**
   - AWS S3への自動バックアップ
   - GitHub Gistでのデータ共有

8. **高度な分析**
   - 問題ごとの正解率統計
   - キーワード別の正解率分析
   - カテゴリ別の傾向分析

## 使用方法

### 初回セットアップ
1. リポジトリをクローンまたはダウンロード
2. HTTPサーバーを起動:
   ```bash
   python -m http.server 8000
   # または
   npx http-server -p 8000
   ```
3. ブラウザで `http://localhost:8000` にアクセス

### GitHub Pagesでの公開
1. GitHubリポジトリの Settings → Pages
2. Source: `main`ブランチ、`/ (root)`
3. 公開URLにアクセス（例: `https://username.github.io/food_quiz_app/`）

### レビューの実行
1. ホーム画面でレビューア名を入力（1人）
2. 問題セット（food_quiz）を選択
3. レビュー画面で回答を選択
4. 必要に応じてコメントを追加
5. 「回答を提出」をクリックして結果確認
6. 「次の問題へ」で続行、または「レビュー完了」で終了

### データのエクスポート
ブラウザのコンソールで以下を実行:
```javascript
// JSON形式でエクスポート
StorageManager.exportToJSON();

// CSV形式でエクスポート
StorageManager.exportToCSV();

// 統計情報を取得
const stats = StorageManager.getStatistics();
console.log(stats);

// すべてのデータを削除
StorageManager.clearAll();
```

## トラブルシューティング

### 問題: JSONが読み込めない
**原因**: file://プロトコルを使用している
**解決**: HTTPサーバーを起動してアクセス

### 問題: データが保存されない
**原因**: localStorageが無効化されている
**解決**: ブラウザの設定でlocalStorageを有効化、またはシークレットモードを解除

### 問題: カスタムURLが動作しない
**原因**: プライベートリポジトリ、またはURL形式が不正
**解決**: パブリックリポジトリであること、URL形式が `https://github.com/user/repo/tree/branch/path` であることを確認

## 参考リソース
- [GitHub REST API](https://docs.github.com/en/rest)
- [localStorage API](https://developer.mozilla.org/ja/docs/Web/API/Window/localStorage)
- [Fetch API](https://developer.mozilla.org/ja/docs/Web/API/Fetch_API)
